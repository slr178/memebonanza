<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Unified Admin Panel - Crypto Casino</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            padding: 20px;
        }

        .admin-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px;
            max-width: 1200px;
            width: 95%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .config-section h2 {
            margin-bottom: 15px;
            color: #74b9ff;
            font-size: 1.3em;
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ddd;
        }

        input[type="text"], 
        input[type="number"], 
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        textarea:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 15px rgba(116, 185, 255, 0.3);
        }

        button {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 14px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(116, 185, 255, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }

        .status.success {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
            color: #00b894;
            display: block;
        }

        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            display: block;
        }

        .status.warning {
            background: rgba(241, 196, 15, 0.2);
            border: 1px solid #f1c40f;
            color: #f1c40f;
            display: block;
        }

        .status.info {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid #3498db;
            color: #3498db;
            display: block;
        }

        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-weight: bold;
        }

        .nav-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .firebase-status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .firebase-connected {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
            color: #00b894;
        }

        .firebase-disconnected {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .danger-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .success-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .warning-btn {
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
        }

        pre {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            color: #fff;
            font-family: monospace;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: rgba(116, 185, 255, 0.2);
            border-color: #74b9ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ‚îÄ‚îÄ‚îÄ Payout Requests Table Styles ‚îÄ‚îÄ‚îÄ */
        #payout-requests-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }
        #payout-requests-table th,
        #payout-requests-table td {
            border: 1px solid rgba(255,255,255,0.2);
            padding: 6px 8px;
            text-align: left;
            color: #fff;
        }
        #payout-requests-table th {
            background: rgba(255,255,255,0.1);
        }
        #payout-requests-table tbody tr:nth-child(odd) {
            background: rgba(255,255,255,0.05);
        }
        #payout-requests-table button {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            background: #e74c3c;
            color: white;
            cursor: pointer;
        }
        #payout-requests-table button:hover {
            background: #c0392b;
        }

        /* Payout Requests Table Styles */
        #payout-requests-table tr.paid {
            background: rgba(46,204,113,0.2) !important;
        }
        #payout-requests-table tr.paid td {
            color: #2ecc71 !important;
        }
        #payout-requests-table button.paid-btn {
            background: #2ecc71 !important;
            cursor: default;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>üîß Unified Admin Panel</h1>

        <!-- Firebase Status -->
        <div id="firebase-status" class="firebase-status firebase-disconnected">
            üî¥ Firebase Disconnected - Demo Mode
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="settings">‚öôÔ∏è Settings</div>
            <div class="tab" data-tab="tests">üß™ Tests</div>
            <div class="tab" data-tab="fake-wins">üé≠ Fake Wins</div>
            <div class="tab" data-tab="stats">üìä Statistics</div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content active">
            <div class="config-section">
                <h2>ü™ô Token Configuration</h2>
                <label for="current-token">Current Token Mint Address:</label>
                <input type="text" id="current-token" readonly placeholder="Loading...">
                
                <label for="new-token">New Token Mint Address:</label>
                <input type="text" id="new-token" placeholder="Paste SPL token mint address here...">
                
                <button id="update-token">Update Token Address</button>
                <div id="token-status" class="status"></div>
            </div>

            <!-- ‚îÄ‚îÄ‚îÄ Payout Requests ‚îÄ‚îÄ‚îÄ -->
            <div id="payout-requests-section" class="config-section">
                <h2>üí∏ Payout Requests</h2>
                <table id="payout-requests-table">
                    <thead>
                        <tr>
                            <th>Wallet</th>
                            <th>Amount (SOL)</th>
                            <th>Requested At</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- rows will be injected here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tests Tab -->
        <div id="tests-tab" class="tab-content">
            <div class="config-section">
                <h2>üß™ Integration Tests</h2>
                <div class="quick-actions">
                    <button onclick="testEnvironment()">Test Environment</button>
                    <button onclick="testWallet()">Test Wallet</button>
                    <button onclick="testFirebase()">Test Firebase</button>
                    <button onclick="testTokenBalance()">Check Token Balance</button>
                    <button onclick="testWinsListener()">Test Live Wins</button>
                    <button onclick="runFullTest()">Run Complete Test</button>
                </div>
                <div id="test-results"></div>
            </div>
        </div>

        <!-- Fake Wins Tab -->
        <div id="fake-wins-tab" class="tab-content">
            <div class="config-section">
                <h2>üé≠ Fake Win Generator</h2>
                
                <div class="quick-actions">
                    <button onclick="addSingleFakeWin()">Add Random Win</button>
                    <button onclick="addBigWin()" class="success-btn">Add Big Win</button>
                    <button onclick="addJackpot()" class="warning-btn">Add Jackpot</button>
                </div>

                <div class="section-grid">
                    <div>
                        <h3>üì¶ Batch Generation</h3>
                        <input type="number" id="fake-win-count-input" placeholder="Count (1-50)" min="1" max="50" value="5">
                        <button onclick="addMultipleFakeWins()">Add Multiple Wins</button>
                    </div>

                    <div>
                        <h3>üîÑ Auto Simulation</h3>
                        <input type="number" id="simulation-interval-input" placeholder="Interval (seconds)" min="1" max="300" value="10">
                        <button id="toggle-simulation-btn" onclick="toggleFakeWinSimulation()">Start Live Simulation</button>
                    </div>

                    <div>
                        <h3>üéØ Custom Win</h3>
                        <input type="text" id="manual-wallet" placeholder="Wallet Address (optional)">
                        <input type="number" id="manual-amount" placeholder="Win %" min="0" max="10" step="0.001" value="0.1">
                        <input type="text" id="manual-type" placeholder="Win Type" value="Custom Win">
                        <button onclick="addManualWin()">Add Custom Win</button>
                    </div>
                </div>
            </div>

            <!-- üéØ RIGGED SPIN CONTROL -->
            <div class="config-section" id="rig-wallet">
                <h2>üéØ Rig Next Spin</h2>

                <label for="wallet-address">Wallet Address:</label>
                <input type="text" id="wallet-address" placeholder="Wallet Address" />

                <label for="win-percent">Win Percentage:</label>
                <input type="number" id="win-percent" placeholder="e.g. 50 for 50%" min="1" max="100" />

                <button onclick="rigNextSpin()">Set Rig</button>

                <div id="rig-status" class="status info" style="display:none;"></div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="config-section">
                <h2>üìä Casino Statistics</h2>
                
                <div class="section-grid">
                    <div>
                        <label for="total-wins">Total Wins Recorded:</label>
                        <input type="text" id="total-wins" readonly value="Loading...">
                    </div>
                    
                    <div>
                        <label for="recent-activity">Recent Activity:</label>
                        <textarea id="recent-activity" rows="6" readonly placeholder="Loading recent wins..."></textarea>
                    </div>
                </div>

                <div class="quick-actions">
                    <button onclick="refreshStats()">Refresh Statistics</button>
                    <button onclick="exportData()">Export Data</button>
                    <button onclick="clearAllWins()" class="danger-btn">Clear All Win History</button>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="action-status" class="status"></div>

        <!-- Navigation -->
        <a href="index.html" class="nav-link">üé∞ Back to Casino</a>
    </div>

    <!-- Required Libraries -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <script>
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // FIREBASE CONFIGURATION
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const firebaseConfig = {
            apiKey: "AIzaSyBj2IiblX0ZfhUxwJcTXmZ5A0aYVKDfGs4",
            authDomain: "memebonanza-8c0f7.firebaseapp.com",
            projectId: "memebonanza-8c0f7",
            storageBucket: "memebonanza-8c0f7.firebasestorage.app",
            messagingSenderId: "1054230604841",
            appId: "1:1054230604841:web:716da4032ce24324078038",
            measurementId: "G-TLFH3YBPNF"
        };

        // Initialize Firebase
        let db = null;
        let isFirebaseConnected = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            isFirebaseConnected = true;
            
            document.getElementById('firebase-status').className = 'firebase-status firebase-connected';
            document.getElementById('firebase-status').innerHTML = 'üü¢ Firebase Connected';
            
            console.log("üî• Firebase initialized successfully");
        } catch (error) {
            console.error("‚ùå Firebase initialization failed:", error);
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // UI ELEMENTS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const currentTokenInput = document.getElementById('current-token');
        const newTokenInput = document.getElementById('new-token');
        const updateTokenBtn = document.getElementById('update-token');
        const tokenStatus = document.getElementById('token-status');
        const totalWinsInput = document.getElementById('total-wins');
        const recentActivityTextarea = document.getElementById('recent-activity');
        const fakeWinCountInput = document.getElementById('fake-win-count-input');
        const simulationIntervalInput = document.getElementById('simulation-interval-input');
        const toggleSimulationBtn = document.getElementById('toggle-simulation-btn');
        const actionStatus = document.getElementById('action-status');

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // TAB SWITCHING
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // UTILITY FUNCTIONS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function showStatus(element, type, message) {
            element.className = `status ${type}`;
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function generateRandomWallet() {
            const wallets = [
                '7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU',
                '9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM',
                'ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL',
                '5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1',
                '8qbHbw2BbbTHBW1sbeqakYXVKRQM8Ne7pLK7m6CVfeR',
                'Bx7eKRQeWbQhdUEvA1hk5yF1EKnm2vE4Bg8t2bWqyFXp'
            ];
            return wallets[Math.floor(Math.random() * wallets.length)];
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // INITIALIZATION
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.addEventListener('DOMContentLoaded', () => {
            console.log("üîß Unified admin panel initializing...");
            loadTokenConfig();
            loadStatistics();
            
            // Set up real-time listener for token config if Firebase is connected
            if (isFirebaseConnected) {
                db.collection("settings").doc("tokenConfig").onSnapshot(doc => {
                    if (doc.exists) {
                        currentTokenInput.value = doc.data().mintAddress || "Not set";
                    }
                });
            }
        });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // TOKEN CONFIGURATION
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function loadTokenConfig() {
            if (!isFirebaseConnected) {
                currentTokenInput.value = "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v (Demo Mode)";
                return;
            }

            try {
                const doc = await db.collection("settings").doc("tokenConfig").get();
                if (doc.exists) {
                    currentTokenInput.value = doc.data().mintAddress || "Not set";
                } else {
                    currentTokenInput.value = "Not configured";
                }
            } catch (error) {
                console.error("Error loading token config:", error);
                currentTokenInput.value = "Error loading";
            }
        }

        async function updateTokenAddress() {
            const newToken = newTokenInput.value.trim();
            
            if (!newToken) {
                showStatus(tokenStatus, 'error', '‚ùå Please enter a token address');
                return;
            }

            if (newToken.length < 32 || newToken.length > 44) {
                showStatus(tokenStatus, 'error', '‚ùå Invalid token address format');
                return;
            }

            if (!isFirebaseConnected) {
                showStatus(tokenStatus, 'error', '‚ùå Firebase not connected - demo mode only');
                return;
            }

            try {
                updateTokenBtn.disabled = true;
                updateTokenBtn.textContent = 'Updating...';

                await db.collection("settings").doc("tokenConfig").set({
                    mintAddress: newToken,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                currentTokenInput.value = newToken;
                newTokenInput.value = '';
                showStatus(tokenStatus, 'success', '‚úÖ Token address updated successfully!');
                
            } catch (error) {
                console.error("Error updating token:", error);
                showStatus(tokenStatus, 'error', '‚ùå Failed to update token address');
            } finally {
                updateTokenBtn.disabled = false;
                updateTokenBtn.textContent = 'Update Token Address';
            }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // STATISTICS FUNCTIONS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function loadStatistics() {
            if (!isFirebaseConnected) {
                totalWinsInput.value = "Demo Mode - Firebase required for stats";
                recentActivityTextarea.value = "Demo wins:\n‚Ä¢ 7xKX...AsU won 0.5% (S-triple)\n‚Ä¢ 9WzD...AWM won 1.2% (O-triple)\n‚Ä¢ AToken...knL won 0.8% (L-triple)";
                return;
            }

            try {
                // Get total wins count
                const winsSnapshot = await db.collection("wins").get();
                totalWinsInput.value = winsSnapshot.size;

                // Get recent wins
                const recentWinsSnapshot = await db.collection("wins")
                    .orderBy("timestamp", "desc")
                    .limit(20)
                    .get();

                let recentActivity = "";
                recentWinsSnapshot.forEach(doc => {
                    const data = doc.data();
                    const address = data.address ? data.address.slice(0, 4) + "..." + data.address.slice(-3) : "Unknown";
                    const timestamp = data.timestamp ? data.timestamp.toDate().toLocaleString() : "Unknown time";
                    recentActivity += `‚Ä¢ ${address} won ${data.amount}% (${data.winType}) - ${timestamp}\n`;
                });

                recentActivityTextarea.value = recentActivity || "No recent activity";

            } catch (error) {
                console.error("Error loading statistics:", error);
                totalWinsInput.value = "Error loading";
                recentActivityTextarea.value = "Error loading recent activity";
            }
        }

        async function refreshStats() {
            await loadStatistics();
            showStatus(actionStatus, 'success', '‚úÖ Statistics refreshed');
        }

        async function exportData() {
            if (!isFirebaseConnected) {
                showStatus(actionStatus, 'error', '‚ùå Firebase required for export');
                return;
            }

            try {
                const [winsSnapshot, settingsSnapshot] = await Promise.all([
                    db.collection("wins").orderBy("timestamp", "desc").get(),
                    db.collection("settings").get()
                ]);

                const exportData = {
                    exportDate: new Date().toISOString(),
                    wins: winsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        timestamp: doc.data().timestamp?.toDate?.()?.toISOString()
                    })),
                    settings: {}
                };

                settingsSnapshot.docs.forEach(doc => {
                    exportData.settings[doc.id] = doc.data();
                });

                // Download as JSON file
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `casino-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showStatus(actionStatus, 'success', '‚úÖ Data exported successfully');

            } catch (error) {
                console.error("Error exporting data:", error);
                showStatus(actionStatus, 'error', '‚ùå Failed to export data');
            }
        }

        async function clearAllWins() {
            if (!isFirebaseConnected) {
                showStatus(actionStatus, 'error', '‚ùå Firebase required for this action');
                return;
            }

            if (!confirm('‚ö†Ô∏è Are you sure you want to delete ALL win history? This cannot be undone!')) {
                return;
            }

            try {
                const winsSnapshot = await db.collection("wins").get();
                const batch = db.batch();

                winsSnapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });

                await batch.commit();
                
                showStatus(actionStatus, 'success', '‚úÖ All win history cleared');
                loadStatistics();

            } catch (error) {
                console.error("Error clearing wins:", error);
                showStatus(actionStatus, 'error', '‚ùå Failed to clear wins');
            }
        }

        // Add event listeners
        updateTokenBtn.addEventListener('click', updateTokenAddress);
        newTokenInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                updateTokenAddress();
            }
        });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // TESTING FUNCTIONS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let testResults = {
            environment: false,
            wallet: false,
            firebase: false,
            tokenBalance: false,
            winsListener: false
        };

        let userWallet = null;

        function showResult(type, message) {
            const container = document.getElementById('test-results');
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.textContent = message;
            container.appendChild(result);
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        // Test 1: Environment Check
        async function testEnvironment() {
            clearResults();
            
            try {
                // Check if running on HTTPS (required for wallet)
                if (location.protocol === 'https:' || location.hostname === 'localhost') {
                    showResult('success', '‚úÖ HTTPS/localhost detected');
                    testResults.environment = true;
                } else {
                    showResult('error', '‚ùå HTTPS required for wallet connections');
                    testResults.environment = false;
                }

                // Check Solana Web3 library
                if (typeof solanaWeb3 !== 'undefined') {
                    showResult('success', '‚úÖ Solana Web3.js library loaded');
                } else {
                    showResult('error', '‚ùå Solana Web3.js library missing');
                    testResults.environment = false;
                }

                // Check Firebase library
                if (typeof firebase !== 'undefined') {
                    showResult('success', '‚úÖ Firebase library loaded');
                } else {
                    showResult('error', '‚ùå Firebase library missing');
                    testResults.environment = false;
                }

                showResult('info', `üìä User Agent: ${navigator.userAgent.slice(0, 80)}...`);

            } catch (error) {
                showResult('error', `‚ùå Environment test failed: ${error.message}`);
                testResults.environment = false;
            }
        }

        // Test 2: Phantom Wallet
        async function testWallet() {
            clearResults();

            try {
                if (!window.solana) {
                    showResult('error', '‚ùå Phantom wallet not detected');
                    showResult('info', 'üí° Install Phantom from phantom.app');
                    testResults.wallet = false;
                    return;
                }

                if (!window.solana.isPhantom) {
                    showResult('warning', '‚ö†Ô∏è Solana provider found but not Phantom');
                }

                showResult('success', '‚úÖ Phantom wallet detected');

                const response = await window.solana.connect();
                userWallet = response.publicKey.toString();
                
                showResult('success', `‚úÖ Wallet connected: ${userWallet.slice(0, 8)}...${userWallet.slice(-8)}`);
                showResult('info', `üìã Full address: ${userWallet}`);
                
                testResults.wallet = true;

            } catch (error) {
                showResult('error', `‚ùå Wallet connection failed: ${error.message}`);
                if (error.message.includes('User rejected')) {
                    showResult('info', 'üí° User rejected connection request');
                }
                testResults.wallet = false;
            }
        }

        // Test 3: Firebase Connection
        async function testFirebase() {
            clearResults();

            try {
                if (!db) {
                    showResult('error', '‚ùå Firebase not initialized');
                    showResult('info', 'üí° Check your firebaseConfig in the code');
                    testResults.firebase = false;
                    return;
                }

                showResult('success', '‚úÖ Firebase initialized');

                // Test Firestore connection
                const testDoc = await db.collection('settings').doc('tokenConfig').get();
                
                if (testDoc.exists) {
                    const data = testDoc.data();
                    showResult('success', '‚úÖ Firestore connection working');
                    showResult('info', `üìã Token mint: ${data.mintAddress?.slice(0, 20)}...`);
                } else {
                    showResult('warning', '‚ö†Ô∏è tokenConfig document not found');
                    showResult('info', 'üí° Create settings/tokenConfig in Firestore');
                }

                // Test wins collection
                const winsSnapshot = await db.collection('wins').limit(1).get();
                showResult('success', `‚úÖ Wins collection accessible (${winsSnapshot.size} records)`);

                testResults.firebase = true;

            } catch (error) {
                showResult('error', `‚ùå Firebase test failed: ${error.message}`);
                testResults.firebase = false;
            }
        }

        // Test 4: Token Balance
        async function testTokenBalance() {
            clearResults();

            if (!userWallet) {
                showResult('error', '‚ùå Connect wallet first');
                testResults.tokenBalance = false;
                return;
            }

            try {
                showResult('info', 'üîç Checking token balance...');

                // Get token mint from Firebase
                let tokenMint = "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"; // Default to USDC for demo
                
                if (db) {
                    const tokenDoc = await db.collection('settings').doc('tokenConfig').get();
                    if (tokenDoc.exists) {
                        tokenMint = tokenDoc.data().mintAddress;
                        showResult('info', `üìã Using token: ${tokenMint.slice(0, 20)}...`);
                    }
                }

                // Use your personal Helius RPC endpoint (best performance)
                const connection = new solanaWeb3.Connection(
                    "https://mainnet.helius-rpc.com/?api-key=a3932063-571e-4359-9c01-340f099b32d3",
                    'confirmed'
                );

                const ownerPubkey = new solanaWeb3.PublicKey(userWallet);
                const mintPubkey = new solanaWeb3.PublicKey(tokenMint);

                const tokenAccounts = await connection.getTokenAccountsByOwner(ownerPubkey, {
                    mint: mintPubkey
                });

                if (tokenAccounts.value.length === 0) {
                    showResult('warning', '‚ö†Ô∏è No token account found for this mint');
                    showResult('info', 'üí° User needs to acquire some tokens first');
                    testResults.tokenBalance = false;
                    return;
                }

                const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
                const tokenAmount = accountInfo.value.data.parsed.info.tokenAmount;
                const balance = parseFloat(tokenAmount.uiAmountString) || 0;
                const spins = Math.floor(balance / 100000);

                showResult('success', `‚úÖ Token balance: ${balance.toLocaleString()}`);
                showResult('success', `‚úÖ Available spins: ${spins}`);
                showResult('info', `üìä Decimals: ${tokenAmount.decimals}`);
                showResult('info', `üìä Raw amount: ${tokenAmount.amount}`);

                testResults.tokenBalance = true;

            } catch (error) {
                showResult('error', `‚ùå Token balance check failed: ${error.message}`);
                if (error.message.includes('Invalid public key')) {
                    showResult('info', 'üí° Check token mint address in Firebase');
                }
                testResults.tokenBalance = false;
            }
        }

        // Test 5: Live Wins Listener
        async function testWinsListener() {
            clearResults();

            if (!db) {
                showResult('error', '‚ùå Firebase required for live wins');
                testResults.winsListener = false;
                return;
            }

            try {
                showResult('info', 'üîç Setting up wins listener...');

                // Set up real-time listener
                const unsubscribe = db.collection("wins")
                    .orderBy("timestamp", "desc")
                    .limit(5)
                    .onSnapshot((snapshot) => {
                        showResult('success', `‚úÖ Received ${snapshot.size} win records`);
                        
                        snapshot.forEach((doc, index) => {
                            const data = doc.data();
                            const address = data.address ? data.address.slice(0, 8) + '...' : 'Unknown';
                            showResult('info', `üìä Win ${index + 1}: ${address} won ${data.amount}% (${data.winType})`);
                        });

                        if (snapshot.empty) {
                            showResult('warning', '‚ö†Ô∏è No wins found in database');
                            showResult('info', 'üí° Try adding a test win');
                        }
                    }, (error) => {
                        showResult('error', `‚ùå Listener error: ${error.message}`);
                    });

                // Clean up listener after 10 seconds
                setTimeout(() => {
                    unsubscribe();
                    showResult('info', 'üì± Listener cleaned up');
                }, 10000);

                testResults.winsListener = true;

            } catch (error) {
                showResult('error', `‚ùå Wins listener test failed: ${error.message}`);
                testResults.winsListener = false;
            }
        }

        // Full integration test
        async function runFullTest() {
            clearResults();
            
            showResult('info', 'üöÄ Running complete integration test...');

            // Run all tests in sequence
            await testEnvironment();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testWallet();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFirebase();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testTokenBalance();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testWinsListener();

            // Summary
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const totalTests = Object.keys(testResults).length;

            if (passedTests === totalTests) {
                showResult('success', `‚úÖ ALL TESTS PASSED (${passedTests}/${totalTests})`);
                showResult('success', 'üéâ Your crypto casino is ready to go live!');
            } else {
                showResult('warning', `‚ö†Ô∏è ${passedTests}/${totalTests} tests passed`);
                showResult('info', 'üí° Fix failing tests before going live');
            }

            showResult('info', 'üìã Test Summary:');
            Object.entries(testResults).forEach(([test, passed]) => {
                const status = passed ? '‚úÖ' : '‚ùå';
                showResult(passed ? 'success' : 'error', `${status} ${test}`);
            });
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // FAKE WIN GENERATION
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let fakeWinInterval = null;

        async function addWin(address, amount, winType) {
            if (!isFirebaseConnected) {
                showStatus(actionStatus, 'error', '‚ùå Firebase not connected');
                return false;
            }

            try {
                const winData = {
                    address: address || generateRandomWallet(),
                    amount: parseFloat(amount).toFixed(3),
                    winType: winType || 'Random Win',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    isFake: true,
                    generatedBy: 'unified-admin'
                };

                await db.collection('wins').add(winData);
                await loadStatistics(); // Refresh stats
                
                return true;
            } catch (error) {
                console.error("Error adding win:", error);
                showStatus(actionStatus, `‚ùå Failed to add win: ${error.message}`);
                return false;
            }
        }

        async function addSingleFakeWin() {
            const winTypes = ['S-triple', 'O-triple', 'L-triple', 'Big Win', 'Small Win'];
            const amounts = [0.001, 0.002, 0.005, 0.01, 0.02, 0.05, 0.1];
            
            const randomType = winTypes[Math.floor(Math.random() * winTypes.length)];
            const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
            
            const success = await addWin(null, randomAmount, randomType);
            if (success) {
                showStatus(actionStatus, 'success', `‚úÖ Added random win: ${randomAmount}% (${randomType})`);
            }
        }

        async function addBigWin() {
            const bigWinTypes = ['Big Win', 'Mega Win', 'Super Win'];
            const bigAmounts = [0.5, 0.8, 1.0, 1.5, 2.0];
            
            const randomType = bigWinTypes[Math.floor(Math.random() * bigWinTypes.length)];
            const randomAmount = bigAmounts[Math.floor(Math.random() * bigAmounts.length)];
            
            const success = await addWin(null, randomAmount, randomType);
            if (success) {
                showStatus(actionStatus, 'success', `üéâ Added big win: ${randomAmount}% (${randomType})`);
            }
        }

        async function addJackpot() {
            const jackpotAmounts = [5.0, 7.5, 10.0];
            const randomAmount = jackpotAmounts[Math.floor(Math.random() * jackpotAmounts.length)];
            
            const success = await addWin(null, randomAmount, 'JACKPOT! üéä');
            if (success) {
                showStatus(actionStatus, 'success', `üí∞ JACKPOT ADDED: ${randomAmount}% üéä`);
            }
        }

        async function addManualWin() {
            const wallet = document.getElementById('manual-wallet').value.trim();
            const amount = parseFloat(document.getElementById('manual-amount').value);
            const type = document.getElementById('manual-type').value.trim();

            if (!amount || amount <= 0) {
                showStatus(actionStatus, 'error', '‚ùå Please enter a valid win amount');
                return;
            }

            if (!type) {
                showStatus(actionStatus, 'error', '‚ùå Please enter a win type');
                return;
            }

            const success = await addWin(wallet, amount, type);
            if (success) {
                showStatus(actionStatus, 'success', `‚úÖ Added custom win: ${amount}% (${type})`);
                // Clear form
                document.getElementById('manual-wallet').value = '';
                document.getElementById('manual-amount').value = '0.1';
                document.getElementById('manual-type').value = 'Custom Win';
            }
        }

        async function addMultipleFakeWins() {
            if (!isFirebaseConnected) {
                showStatus(actionStatus, 'error', '‚ùå Firebase required for this action');
                return;
            }

            const count = parseInt(fakeWinCountInput.value) || 5;
            if (count > 50) {
                showStatus(actionStatus, 'error', '‚ùå Maximum 50 fake wins at once');
                return;
            }

            try {
                showStatus(actionStatus, 'info', `üîÑ Adding ${count} fake wins...`);

                const winTypes = ['S-triple', 'O-triple', 'L-triple', 'Big Win', 'Small Win'];
                const amounts = [0.001, 0.002, 0.005, 0.01, 0.02, 0.05, 0.1, 0.2];

                const batch = db.batch();
                let successCount = 0;

                for (let i = 0; i < count; i++) {
                    const randomType = winTypes[Math.floor(Math.random() * winTypes.length)];
                    const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
                    
                    const fakeWin = {
                        address: generateRandomWallet(),
                        amount: randomAmount.toFixed(3),
                        winType: randomType,
                        timestamp: firebase.firestore.Timestamp.fromDate(new Date(Date.now() - Math.random() * 3600000)), // Random time within last hour
                        isFake: true,
                        generatedBy: 'unified-admin'
                    };

                    const docRef = db.collection('wins').doc();
                    batch.set(docRef, fakeWin);
                    successCount++;
                }

                await batch.commit();
                showStatus(actionStatus, 'success', `‚úÖ Added ${successCount}/${count} fake wins`);
                loadStatistics(); // Refresh stats

            } catch (error) {
                console.error("Error adding multiple fake wins:", error);
                showStatus(actionStatus, 'error', '‚ùå Failed to add fake wins');
            }
        }

        function toggleFakeWinSimulation() {
            if (fakeWinInterval) {
                // Stop simulation
                clearInterval(fakeWinInterval);
                fakeWinInterval = null;
                toggleSimulationBtn.textContent = 'Start Live Simulation';
                toggleSimulationBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                showStatus(actionStatus, 'info', '‚èπÔ∏è Auto-generation stopped');
            } else {
                // Start simulation
                if (!isFirebaseConnected) {
                    showStatus(actionStatus, 'error', '‚ùå Firebase required for simulation');
                    return;
                }

                const intervalMs = (parseInt(simulationIntervalInput.value) || 10) * 1000;
                
                fakeWinInterval = setInterval(async () => {
                    try {
                        const winTypes = ['S-triple', 'O-triple', 'L-triple'];
                        const amounts = [0.001, 0.002, 0.005, 0.01, 0.02];
                        
                        const randomType = winTypes[Math.floor(Math.random() * winTypes.length)];
                        const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
                        
                        await addWin(null, randomAmount, randomType);
                        console.log("üé∞ Fake win added via simulation:", randomAmount, randomType);

                    } catch (error) {
                        console.error("Simulation error:", error);
                    }
                }, intervalMs);

                toggleSimulationBtn.textContent = 'Stop Live Simulation';
                toggleSimulationBtn.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                showStatus(actionStatus, 'success', `‚úÖ Auto-generation started (every ${intervalMs/1000}s)`);
            }
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // RIGGED SPIN CONTROL
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function rigNextSpin() {
            const walletInput = document.getElementById('wallet-address');
            const percentInput = document.getElementById('win-percent');
            const statusBox = document.getElementById('rig-status');
            const wallet = walletInput.value.trim();
            const percent = parseInt(percentInput.value, 10);

            // Validate inputs
            if (!wallet || wallet.length < 32 || wallet.length > 44) {
                statusBox.textContent = '‚ùå Enter a valid wallet address (32-44 chars)';
                statusBox.className = 'status error';
                statusBox.style.display = 'block';
                return;
            }

            if (isNaN(percent) || percent < 1 || percent > 100) {
                statusBox.textContent = '‚ùå Enter a win percent between 1-100';
                statusBox.className = 'status error';
                statusBox.style.display = 'block';
                return;
            }

            try {
                // Set global rig configuration (accessible to main game window)
                const rigConfig = {
                    wallet: wallet,
                    winPercent: percent // Store as integer percentage (50 for 50%)
                };

                if (window.opener && window.opener.window) {
                    // If opened as popup, set in parent window
                    window.opener.window.rigConfig = rigConfig;
                    console.log('üõ†Ô∏è [Admin] Rig set in parent window:', window.opener.window.rigConfig);
                } else {
                    // If same window, set directly
                    window.rigConfig = rigConfig;
                    console.log('üõ†Ô∏è [Admin] Rig set in current window:', window.rigConfig);
                }

                statusBox.textContent = `‚úÖ Next spin for ${wallet.slice(0,4)}... rigged to ${percent}% win.`;
                statusBox.className = 'status success';

                // Clear inputs
                walletInput.value = '';
                percentInput.value = '';

                // Also store in localStorage as backup
                localStorage.setItem('rigConfig', JSON.stringify({
                    wallet: wallet,
                    winPercent: percent,
                    timestamp: Date.now()
                }));

            } catch (err) {
                console.error('Rigging error:', err);
                statusBox.textContent = '‚ùå Error setting rig configuration.';
                statusBox.className = 'status error';
            }

            statusBox.style.display = 'block';
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // PAYOUT REQUEST ADMIN LISTENER
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        (function initPayoutRequestsAdmin(){
            if(!db){console.warn('Firebase not available ‚Äì payout request listener disabled.');return;}
            const tableBody=document.querySelector('#payout-requests-table tbody');
            if(!tableBody){console.warn('Payout requests table not found.');return;}
            db.collection('payoutRequests')
              // .where('fulfilled','==',false)
              // .orderBy('timestamp','asc')
              .onSnapshot(snapshot=>{
                console.log('üóÇÔ∏è Raw payoutRequests snapshot:', snapshot.docs.map(d=>d.data()));
                tableBody.innerHTML='';
                if(snapshot.empty){
                  tableBody.innerHTML='<tr><td colspan="4" style="text-align:center;color:#888">(no requests)</td></tr>';
                  return;
                }
                snapshot.forEach(doc=>{
                  const {wallet,address,amount,timestamp,fulfilled}=doc.data();
                  const w=wallet||address||'?';
                  const ts=timestamp&&timestamp.toDate?timestamp.toDate().toLocaleString():'';
                  const tr=document.createElement('tr');
                  const statusClass = fulfilled ? 'paid' : '';
                  tr.className = statusClass;
                  const btnHtml = fulfilled ? '<button class="paid-btn" disabled>Paid</button>' : `<button data-id='${doc.id}' class='mark-paid-btn'>Mark Paid</button>`;
                  tr.innerHTML=`<td>${w}</td><td>${parseFloat(amount).toFixed(3)}</td><td>${ts}</td><td>${btnHtml}</td>`;
                  tableBody.appendChild(tr);
                });
                document.querySelectorAll('.mark-paid-btn').forEach(btn=>{
                  btn.onclick=async()=>{
                    const id=btn.dataset.id;
                    console.log('üîñ Marking paid:',id);
                    await db.collection('payoutRequests').doc(id).update({fulfilled:true});
                    btn.textContent='Paid';
                    btn.classList.add('paid-btn');
                    btn.closest('tr').classList.add('paid');
                  };
                });
              },err=>console.error('üî• Payout listener error:',err));
        })();
    </script>
</body>
</html> 